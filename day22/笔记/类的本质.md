- 类的本质其实也是一个对象(类对象)。
  
- 程序中第一次使用该类的时候被创建，在整个程序中只有一份。
  
- 此后每次使用都是这个类对象，它在程序运行时一直存在。
  
- 类对象是一种数据结构,存储类的基本信息:类大小,类名称,类的版本，继承层次，以及消息与函数的映射表等。
  
- 类对象代表类,Class类型,__对象方法属于类对象（对象方法列表）__。
  
- 如果消息的接收者是类名,则类名代表类对象。
  
- 所有类的实例都由类对象生成,类对象会把实例的isa的值修改成自己的地址,每个实例的isa都指向该实例的类对象。
  
- 获取类对象
  
  ``` objective-c
  [person class]; // 通过实例对象
  [Person class]; // 通过类对象
  ```
  
- 类对象的用法
  
  ``` objective-c
  // 用来调用类方法
  Class c = [Dog class];
  [c test];
  
  // 用来创建实例对象
  Class c = [Dog class];
  Dog *g1 = [c new];
  ```
  
- __OC实例对象 类对象 元对象之间关系__
  
  - 在Xcode中按Shift + Command + O打开文件搜索框，然后输入NSObject.h和objc.h,可以打开 NSObject的定义头文件,通过头文件我们可以看到,NSObject就是一个包含isa指针的结构体。
  - 按照面向对象语言的设计原则,所有事物都应该是对象(严格来说 Objective-C并没有完全做到这一点,因为它有int,double这样的简单变量类型)。
    - 在Objective-C语言中,__每一个类实际上也是一个对象__。每一个类也有一个名为isa的指针。每一个类都可以接受消息,例如[NSObject new],就是向NSObject这个类发送名为new的消息。
    - 在Xcode中按Shift + Command + O,然后输入runtime.h,可以打开Class的定义头文件,通过头文件我们可以看到,Class也是一个包含isa指针的结构体。
    - 因为类也是一个对象,那它也必须是另一个类的实例,这个类就是元类 (metaclass)。
      - 元类保存了类方法的列表。当一个类方法被调用时,元类会首先查找它本身是否有该类方法的实现,如果没有则该元类会向它的父类查找该方法,直到一直找到继承链的头。
      - 元类(metaclass)也是一个对象,那么元类的isa指针又指向哪里呢?为了设计上的完整,所有的元类的isa指针都会指向一个根元类(root metaclass)。
      - 根元类(root metaclass)本身的isa指针指向自己,这样就行成了一个闭环。上面说􏰀到,一个对象能够接收的消息列表是保存在它所对应的类中的。在实际编程中,我们几乎不会遇到向元类发消息的情况,那它的isa 指针在实际上很少用到。不过这么设计保证了面向对象的干净,即所有事物都是对象,都有isa指针。
      - 由于类方法的定义是保存在元类(metaclass)中,而方法调用的规则是,如果该类没有一个方法的实现,则向它的父类继续查找。所以为了保证父类的类方法可以在子类中可以被调用,所以子类的元类会继承父类的元类,换而言之,类对象和元类对象有着同样的继承关系。
    - ![](/Users/joyann/Documents/Joyann/小码哥/我的学习笔记/day22/笔记/元类根元类.png )
    - 如上图所示。假设最下边是一个Student类。
      - Instance of Subclass为一个Student的对象student，那么它有一个isa指针指向Subclass(class)即Student类对象，Student类对象中有student的对象方法列表，所以每次像student发送对象消息，那么就会通过isa去Student类对象里找，如果找不到，则Student类对象会去自己的父类Superclass(class)里面找（假设是个Person类），Person类里也有对象方法列表，如果仍然没找到，再去它的父类Root class(class)里面找，实际上这个类就是NSObject类，NSObject类里面也有对象方法列表，如果在这里面仍然没找到相应的方法，那么则是nil，说明没有找到该对象方法，程序报错。
      - 回到最下面，Student类对象也是一个对象，它有一个isa指针指向Subclass(meta)元对象，这个元对象里面有类方法列表。所以每次我们对类发送消息，那么类对象直接通过isa指针找到元类对象，然后在元类对象的类方法列表里找方法，如果没找到，则像上面说的那样，去父类找，一直找到NSObject的元类对象，NSObject的元类对象又继承自NSObject，所以会一直找到NSObject类，如果没有则报错。（类方法要比对象方法效率高，也是因为类方法不需要对象来找isa指针找到类对象，然后类对象再通过isa找元类的方法列表，而是直接找到类对象然后通过isa找到元类对象方法列表）
      - 可以看到，元类对象也是对象，那么说明也有isa指针，元类对象的isa指针指向根元类对象，而根元类对象也是对象，也有isa指针，根元类对象的isa指针指向自己，形成闭环。而NSObject类的对象的isa指针指向NSObject类对象，NSObject类对象的isa指向元类对象，也就是根元类对象（图中最上面的一行）。
      - 总结：
        - 给实例对象发送消息的过程(调用对象方法)
          1. 根据对象的isA指针去该对象的类方法中查找，如果找到了就执行。
          2. 如果没有找到，就去该类的父类类对象中查找。
          3. 如果没有找到就一直往上找，直到根类（NSObject）。
          4. 如果都没有找到就报错。
        - 给类对象发送消息(调用类方法)
          1. 根据类对象的isA指针去元对象中查找，如果找到了就执行。
          2. 如果没有找到就去父元对象中查找。
          3. 如果如果没有找到就一直往上查找，直到根类（NSOject）。
          4. 如果都没有找到就报错。